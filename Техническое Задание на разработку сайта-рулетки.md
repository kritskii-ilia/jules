# Техническое Задание на разработку сайта-рулетки

## 1. Введение

### 1.1. Назначение документа

Настоящее Техническое Задание (ТЗ) определяет требования к разработке программного обеспечения (ПО) – веб-сайта с игровыми режимами типа «рулетка» (далее – «Сайт» или «Платформа»). Сайт предназначен для развлечения пользователей посредством участия в различных игровых режимах с использованием виртуальной валюты, пополняемой через криптовалюты.

### 1.2. Заказчик

[Имя Заказчика или Компания Заказчика – будет уточнено при необходимости]

### 1.3. Исполнитель

Искусственный Интеллект (ИИ) под управлением команды Manus.

### 1.4. Основание для разработки

Запрос Заказчика на создание сайта-рулетки с функционалом, частично основанным на сайте csgf.cc, и добавлением уникальных игровых режимов.

### 1.5. Цели создания Сайта

*   Создание развлекательной онлайн-платформы с несколькими игровыми режимами.
*   Обеспечение возможности для пользователей делать ставки и выигрывать виртуальную валюту.
*   Реализация удобной системы пополнения баланса и вывода средств с использованием криптовалют.
*   Предоставление административных инструментов для управления Сайтом и пользователями.

### 1.6. Целевая аудитория

Пользователи, заинтересованные в онлайн-играх формата «рулетка» и азартных развлечениях с использованием виртуальной валюты и криптовалют.

### 1.7. Общее описание Сайта

Сайт представляет собой веб-платформу, где пользователи могут регистрироваться, пополнять свой игровой баланс, участвовать в различных игровых режимах (рулетках, аукционе, лотерее), общаться в чате и выводить выигранные средства. Платформа будет иметь темный дизайн, интуитивно понятный интерфейс и систему доказуемой честности (Provably Fair).

## 2. Общие требования к Сайту

### 2.1. Валюта и платежи

*   **Игровая валюта:** На Сайте используется внутренняя виртуальная валюта (далее – «монеты»). Курс игровой валюты должен быть четко привязан к реальной валюте (например, 1 монета = 1 рубль, но это будет отображаться только как эквивалент для понимания ценности, без прямого указания на фиатные деньги на пользовательском интерфейсе, чтобы избежать юридических проблем в некоторых регионах).
*   **Пополнение баланса (Депозиты):**
    *   Пополнение баланса должно осуществляться исключительно с использованием криптовалют.
    *   На этапе MVP (Minimum Viable Product) будет реализована поддержка одной криптовалюты – TON (The Open Network).
    *   Механизм пополнения: используется единый статический адрес кошелька Сайта для приема депозитов. Пользователь при переводе средств должен будет указывать в комментарии (memo/destination tag) к транзакции свой уникальный ID на Сайте.
    *   Система должна отслеживать поступления на этот адрес и автоматически зачислять соответствующее количество монет на баланс пользователя при корректном указании ID в memo. В случае отсутствия или некорректного memo, транзакция должна попадать в специальный раздел административной панели для ручной обработки.
    *   Должна быть предусмотрена возможность в будущем добавить поддержку других криптовалют и/или метод генерации уникальных адресов для каждого пополнения.
*   **Вывод средств:**
    *   Вывод средств с игрового баланса должен осуществляться исключительно в криптовалюте.
    *   На этапе MVP будет реализована поддержка вывода в криптовалюте TON.
    *   Пользователь указывает сумму для вывода (в монетах) и адрес своего криптовалютного кошелька.
    *   Заявки на вывод обрабатываются администрацией (возможно, с последующей автоматизацией для определенных сумм/пользователей).
    *   Должна быть предусмотрена возможность в будущем добавить поддержку вывода в других криптовалютах.
*   **Комиссии:**
    *   Комиссии за пополнение и вывод средств со стороны Сайта на этапе MVP не взимаются (кроме стандартных комиссий блокчейн-сетей).
    *   Комиссии Сайта будут взиматься с банков в игровых режимах (см. раздел «Игровые режимы»).

### 2.2. Регистрация и авторизация пользователей

*   Регистрация и авторизация пользователей на Сайте должна осуществляться исключительно через API Telegram.
*   При первой авторизации через Telegram для пользователя автоматически создается аккаунт на Сайте.
*   Система должна получать от Telegram и сохранять необходимую информацию о пользователе (как минимум, уникальный ID Telegram, никнейм, аватар).

### 2.3. Профиль пользователя

Каждый зарегистрированный пользователь должен иметь страницу профиля, доступную ему после авторизации. Страница профиля должна отображать:

*   Аватар и никнейм пользователя (из Telegram).
*   Уникальный ID пользователя на Сайте (для указания в memo при пополнении).
*   Текущий баланс монет.
*   Историю транзакций (пополнения, выводы, участие в играх, выигрыши/проигрыши).
*   Кнопку/функцию «Отключить возможность игр на 24 часа» (для ответственной игры). При активации этой функции пользователь не сможет делать ставки ни в одном из игровых режимов в течение 24 часов. По истечении этого срока доступ к играм возобновляется автоматически.

### 2.4. Дизайн и Пользовательский Интерфейс (UI/UX)

*   **Общий стиль:** Современный, интуитивно понятный.
*   **Цветовая схема:** Преимущественно темная тема для снижения нагрузки на глаза и соответствия предпочтениям целевой аудитории.
*   **Референсы:** В качестве основы для дизайна и пользовательского опыта можно использовать сайт csgf.cc и другие популярные сайты-рулетки, но с созданием уникального визуального стиля.
*   **Адаптивность:** Сайт должен корректно отображаться и функционировать на различных устройствах (десктопы, планшеты, мобильные телефоны) и в популярных браузерах.
*   **Навигация:** Простая и логичная структура меню и навигации по сайту.

### 2.5. Технологический стек

*   Поскольку Заказчик не имеет строгих предпочтений, Исполнитель (ИИ) может выбрать подходящий современный технологический стек для frontend, backend и базы данных, обеспечивающий производительность, масштабируемость и безопасность.
*   Рекомендуется рассмотреть:
    *   **Frontend:** React, Vue.js или Angular.
    *   **Backend:** Node.js (с Express.js или NestJS), Python (Django/Flask), Go.
    *   **База данных:** PostgreSQL, MongoDB или аналогичная, подходящая для хранения данных о пользователях, транзакциях, истории игр.
    *   **Взаимодействие Frontend-Backend:** Через REST API или GraphQL.
    *   **Real-time обновления (для игр, чата):** WebSockets.

### 2.6. Система доказуемой честности (Provably Fair)

*   Все игровые режимы, где результат определяется случайным образом (рулетки, лотерея), должны использовать систему Provably Fair.
*   Система должна позволять пользователям проверять честность каждого игрового раунда.
*   Механизм Provably Fair должен быть подробно описан на Сайте (например, в разделе «Справка» или на отдельной странице).
*   Типичная реализация включает:
    *   **Server Seed (серверное начальное значение):** Генерируется сервером до начала раунда. Хеш этого значения (Hashed Server Seed) отображается игрокам до того, как они сделают ставки.
    *   **Client Seed (клиентское начальное значение):** Может быть предоставлено/изменено пользователем или сгенерировано на стороне клиента.
    *   **Nonce (счетчик игр/ставок):** Увеличивается с каждым раундом/ставкой.
    *   Результат игры генерируется на основе комбинации Server Seed, Client Seed и Nonce.
    *   После окончания раунда Server Seed раскрывается, и пользователи могут самостоятельно проверить результат, используя те же входные данные и алгоритм хеширования.

### 2.7. Чат для игроков

*   На Сайте должен быть реализован общий чат для всех авторизованных игроков.
*   Чат должен отображаться в правой части интерфейса (аналогично csgf.cc).
*   **Функционал чата:**
    *   Отправка текстовых сообщений.
    *   Базовый набор смайликов (emojis).
    *   Отображение никнейма и аватара отправителя.
    *   Возможность для пользователя удалять **свои** сообщения.
    *   Редактирование сообщений не требуется.
    *   Личные сообщения между пользователями не требуются.
    *   Модерация чата осуществляется администраторами через административную панель (см. раздел «Административная панель»).

### 2.8. Ответственная игра

*   На странице профиля пользователя должна быть функция «Отключить возможность игр на 24 часа» (см. п. 2.3).
*   В подвале сайта или в разделе «Справка» должны быть размещены предупреждения о рисках, связанных с азартными играми, и, возможно, ссылки на ресурсы помощи при игровой зависимости (по усмотрению Заказчика).

## 3. Требования к функциональности игровых режимов

На Сайте будет реализовано 5 игровых режимов: 3 режима, аналогичные классической рулетке (джекпоту) с разными лимитами ставок, и 2 новых режима – «Аукцион» и «Лотерея».

Для всех игровых режимов, где это применимо, должна быть возможность настройки комиссии Сайта через административную панель.

### 3.1. Режимы «Классическая Рулетка» (3 комнаты)

Эти режимы основаны на принципе джекпота: игроки вносят ставки, формируя общий банк. По истечении таймера или при достижении определенных условий случайным образом выбирается победитель, который забирает банк за вычетом комиссии Сайта. Шанс выигрыша каждого игрока пропорционален его доле в общем банке.

**Общая механика для всех 3-х комнат:**

1.  **Ставки:** Игроки делают ставки в монетах в пределах установленных лимитов для данной комнаты.
2.  **Формирование банка:** Все ставки суммируются, формируя общий банк раунда.
3.  **Отображение шансов:** Для каждого игрока отображается его процентный шанс на выигрыш, рассчитываемый как (сумма ставок игрока / общий банк) * 100%.
4.  **Таймер:**
    *   В каждой комнате есть таймер обратного отсчета (например, 15-30 секунд, настраивается в АП).
    *   Таймер **не запускается**, если в раунде сделал ставку только **один** игрок. Раунд будет ожидать ставок от других участников.
    *   Таймер **начинает обратный отсчет только тогда, когда как минимум два игрока** сделали ставки в текущем раунде.
    *   После запуска, таймер сбрасывается/продлевается при каждой новой ставке от нового участника (или существующего, если разрешено несколько ставок от одного игрока, что указано в описании комнат как "могут разбивать свои ставки") до определенного предела (если такой предел на продления установлен).
    *   **Важно:** Начавшийся таймер всегда должен дойти до конца своего текущего цикла (например, если он был сброшен на 15 секунд, он отсчитает эти 15 секунд, если не будет новых ставок, сбрасывающих его снова).
5.  **Розыгрыш:** По истечении таймера (или при достижении максимального количества игроков/максимального банка, если такие лимиты будут установлены) система случайным образом выбирает победителя с учетом шансов каждого игрока (используя Provably Fair).
6.  **Комиссия Сайта:** С общего банка перед выплатой победителю взимается комиссия Сайта. Размер комиссии настраивается в админ-панели для каждой комнаты отдельно.

**Конкретные комнаты:**

*   **Комната 1 (например, «Classic Game»):**
    *   Лимиты ставок на одного игрока за раунд: от 1 до 50 монет.
    *   Игроки могут разбивать свои ставки на несколько частей, но общая сумма ставок одного игрока в раунде не должна превышать 50 монет.
    *   Максимальный банк комнаты (если есть, настраивается в админ-панели, например, 500 монет).
    *   Длительность таймера (настраивается в админ-панели).
*   **Комната 2 (например, «Rich Game»):**
    *   Лимиты ставок на одного игрока за раунд: от 50 до 250 монет.
    *   Игроки могут разбивать свои ставки на несколько частей, но общая сумма ставок одного игрока в раунде не должна превышать 250 монет.
    *   Максимальный банк комнаты (настраивается в админ-панели, например, 2500 монет).
    *   Длительность таймера (настраивается в админ-панели).
*   **Комната 3 (например, «Epic Game»):**
    *   Лимиты ставок на одного игрока за раунд: от 250 до 5000 монет.
    *   Игроки могут разбивать свои ставки на несколько частей, но общая сумма ставок одного игрока в раунде не должна превышать 5000 монет.
    *   Максимальный банк комнаты (настраивается в админ-панели, например, 25000 монет).
    *   Длительность таймера (настраивается в админ-панели).

**Интерфейс для режимов «Классическая Рулетка»:**

*   Отображение названия комнаты и номера текущего раунда.
*   Отображение текущего общего банка и максимального банка (если есть).
*   Таймер обратного отсчета.
*   Информация о лимитах ставок в данной комнате.
*   Поле для ввода суммы ставки и кнопка «Сделать ставку».
*   Список участников раунда с их аватарами, никнеймами, суммами ставок и шансами на выигрыш.
*   Визуализация процесса выбора победителя (например, «карусель» с аватарами участников).
*   Отображение информации о Provably Fair для текущего раунда (хеш серверного сида до начала, возможность ввести клиентский сид).

### 3.2. Режим «Аукцион»

**Общая концепция:** Игроки поочередно делают фиксированные ставки. После каждой ставки запускается таймер. Если в течение таймера никто не перебивает ставку, последний поставивший игрок забирает весь банк за вычетом комиссии Сайта.

**Детализация механики:**

1.  **Начало раунда:**
    *   На старте раунда на игровом поле отображается начальный «виртуальный» банк в размере X монет (например, 10 монет). Эта сумма не является реальной ставкой Сайта, а лишь начальным значением, к которому будут добавляться ставки игроков. Фактически, банк начинает формироваться с первой ставки игрока.
    *   Значение X (начальный отображаемый банк) должно быть настраиваемым в административной панели.
2.  **Процесс ставок:**
    *   Любой игрок может сделать ставку. Сумма ставки фиксированная – Y монет (например, 10 монет).
    *   Значение Y (фиксированная ставка игрока) должно быть настраиваемым в административной панели.
    *   Игрок, чья ставка является последней на данный момент, не может делать следующую ставку, пока его ставку не перебьет другой игрок.
3.  **Таймер:**
    *   Таймер запускается на Z секунд (например, 15 секунд) только *после того, как первый игрок сделает ставку*.
    *   Каждая последующая ставка от нового игрока перезапускает таймер на Z секунд.
    *   Продолжительность таймера Z должна быть настраиваемой в административной панели.
4.  **Определение победителя:**
    *   Если в течение Z секунд после последней ставки никто не делает новую ставку, раунд завершается.
    *   Игрок, сделавший последнюю ставку, объявляется победителем.
5.  **Распределение выигрыша:**
    *   Победитель получает весь накопленный банк (сумма всех ставок игроков + начальный отображаемый банк X) за вычетом комиссии Сайта.
    *   Размер комиссии Сайта (например, 10%) должен быть настраиваемым в административной панели.
6.  **Особые случаи:**
    *   Если после отображения начального банка ни один игрок не делает ставку, раунд остается в ожидании неопределенно долго, таймер не запускается.

**Интерфейс режима «Аукцион»:**

*   Отображение текущего общего банка.
*   Отображение таймера обратного отсчета (когда активен).
*   Кнопка «Сделать ставку» (с указанием фиксированной суммы ставки Y).
*   Список последних сделавших ставки игроков (аватар, никнейм).
*   Информация о текущем лидере (последнем поставившем игроке).
*   Четкое отображение правил режима или ссылка на них.
*   Отображение информации о Provably Fair (если применимо к механике определения момента остановки таймера, хотя здесь основной элемент – ставки игроков, а не случайный выбор).

### 3.3. Режим «Лотерея»

**Общая концепция:** Игроки делают ставки на пронумерованные поля. По истечении таймера случайным образом выбирается одно выигрышное поле. Все игроки, поставившие на это поле, делят между собой общий банк (сформированный из ставок на все поля) пропорционально своим ставкам на это выигрышное поле, за вычетом комиссии Сайта.

**Детализация механики:**

1.  **Игровое поле:**
    *   Представлено 25 полей, пронумерованных от 1 до 25.
2.  **Процесс ставок:**
    *   Игроки могут делать ставки на любое из 25 полей.
    *   Игроки могут делать ставки на несколько полей одновременно.
    *   Игроки могут делать несколько ставок на одно и то же поле, увеличивая свою общую ставку на этом поле.
    *   Минимальная сумма одной ставки – M монет (например, 1 монета). Значение M должно быть настраиваемым в административной панели.
    *   Максимальной суммы ставки на одно поле или на все поля в рамках одного раунда нет.
3.  **Таймер:**
    *   Раунд лотереи длится определенное время T (например, 24 часа).
    *   По истечении времени T прием ставок прекращается, и определяется выигрышное поле.
    *   Продолжительность раунда T должна быть настраиваемой в административной панели.
4.  **Определение выигрышного поля:**
    *   После окончания таймера система случайным образом выбирает одно выигрышное число от 1 до 25.
    *   Механизм выбора должен быть прозрачным и использовать систему Provably Fair.
5.  **Распределение выигрыша:**
    *   Общий банк формируется из всех ставок, сделанных на все 25 полей в текущем раунде.
    *   Весь банк (за вычетом комиссии Сайта) распределяется между игроками, которые сделали ставки на выигрышное поле.
    *   Распределение выигрыша между победителями происходит пропорционально их суммарным ставкам на выигрышное поле. (Пример: Поле №7 выиграло. Игрок А поставил 100 монет на поле №7, Игрок Б поставил 50 монет на поле №7. Общий банк лотереи = 1000 монет. Комиссия Сайта 10% = 100 монет. К распределению 900 монет. Игрок А получает (100 / (100+50)) * 900 = 600 монет. Игрок Б получает (50 / (100+50)) * 900 = 300 монет).
    *   Размер комиссии Сайта должен быть настраиваемым в административной панели.
6.  **Особые случаи:**
    *   Если на выигрышное поле никто не сделал ставку, весь банк (все ставки со всех 25 полей) переходит на баланс Сайта (за вычетом комиссии, или вся сумма идет сайту – уточнить у Заказчика, по умолчанию – весь банк забирает сайт).

**Интерфейс режима «Лотерея»:**

*   Отображение 25 пронумерованных полей, на которые можно делать ставки.
*   Для каждого поля – возможность ввести сумму ставки и сделать ставку.
*   Отображение общей суммы ставок игрока на каждом конкретном поле (если он делал ставки).
*   Отображение общей суммы ставок всех игроков на каждом поле (опционально, для прозрачности).
*   Отображение общего банка лотереи (сумма всех ставок на все поля).
*   Таймер обратного отсчета до окончания раунда.
*   После розыгрыша – отображение выигрышного номера и, возможно, списка победителей и их выигрышей.
*   Четкое отображение правил режима или ссылка на них.
*   Отображение информации о Provably Fair для текущего раунда.

## 4. Требования к Административной панели

Административная панель (АП) предназначена для управления Сайтом, пользователями и игровыми процессами. Доступ к АП должен быть защищен (логин/пароль для администраторов).

**Функционал АП:**

1.  **Управление пользователями:**
    *   Просмотр списка всех зарегистрированных пользователей (ID, никнейм Telegram, дата регистрации, текущий баланс, статус).
    *   Поиск пользователей по ID, никнейму.
    *   Просмотр детальной информации о пользователе (история транзакций, история игр, история банов).
    *   **Бан пользователей:**
        *   Возможность забанить пользователя на Сайте (блокировка доступа к игровым режимам и чату) на определенный срок или перманентно. Причина бана.
        *   Возможность забанить пользователя только в чате на определенный срок или перманентно. Причина бана.
        *   Просмотр списка забаненных пользователей, возможность разбана.
    *   **Ручная корректировка баланса пользователя:** Возможность для администратора вручную изменять баланс монет пользователя (с обязательным указанием причины и логированием такого действия).
2.  **Управление игровыми режимами:**
    *   **Общие настройки комиссий:** Возможность устанавливать и изменять размер комиссии Сайта для каждого игрового режима (в процентах от банка).
    *   **Настройки режимов «Классическая Рулетка» (для каждой из 3-х комнат):**
        *   Изменение минимальной и максимальной ставки игрока.
        *   Изменение максимального банка комнаты (если применимо).
        *   Изменение длительности таймера.
    *   **Настройки режима «Аукцион»:**
        *   Изменение размера начального отображаемого банка (X).
        *   Изменение размера фиксированной ставки игрока (Y).
        *   Изменение продолжительности таймера (Z).
    *   **Настройки режима «Лотерея»:**
        *   Изменение минимальной суммы ставки (M).
        *   Изменение продолжительности раунда лотереи (T).
3.  **Финансы и Транзакции:**
    *   Просмотр истории всех транзакций на Сайте (пополнения, выводы, игровые ставки, выигрыши, комиссии Сайта).
    *   Фильтры по типу транзакции, пользователю, дате, сумме.
    *   Обработка «проблемных» депозитов (где не указан или некорректно указан memo/ID).
    *   Управление заявками на вывод средств (одобрение, отклонение с указанием причины).
    *   Статистика по доходам Сайта (комиссии с игр).
4.  **Управление чатом:**
    *   Просмотр логов чата.
    *   Удаление сообщений любых пользователей.
    *   Бан пользователей в чате (см. Управление пользователями).
5.  **Управление контентом:**
    *   Редактирование текста на статических страницах (например, FAQ, Условия использования, Описание Provably Fair, Политика конфиденциальности).
6.  **Просмотр логов:**
    *   Логи действий администраторов в АП.
    *   Логи системных событий и ошибок на Сайте.
7.  **Статистика Сайта:**
    *   Общее количество зарегистрированных пользователей.
    *   Количество активных пользователей (онлайн, за день, за неделю, за месяц).
    *   Количество сыгранных игр (по каждому режиму и суммарно).
    *   Общие суммы депозитов и выводов.
    *   Другие ключевые метрики по запросу Заказчика.

## 5. Требования к безопасности

*   Защита от распространенных веб-уязвимостей (XSS, CSRF, SQL-инъекции и т.д.).
*   Безопасное хранение паролей администраторов (хеширование с солью).
*   Защита API от несанкционированного доступа.
*   Регулярное резервное копирование базы данных.
*   Защита от DDoS-атак (на уровне хостинга или с использованием специализированных сервисов).
*   Безопасность при работе с криптовалютными кошельками (хранение приватных ключей, обработка транзакций).
*   Логирование всех важных событий безопасности.

## 6. Требования к развертыванию и поддержке (MVP)

*   **Развертывание:** Исполнитель должен предоставить инструкции или обеспечить развертывание MVP на хостинге Заказчика (или рекомендованном хостинге).
*   **Документация:** Предоставление документации для администраторов по работе с АП и базовой технической документации по архитектуре Сайта.
*   **Поддержка:** Условия дальнейшей поддержки и обновлений обсуждаются отдельно.

## 7. Будущие возможные доработки (не входят в MVP)

*   Добавление поддержки других криптовалют для пополнения и вывода.
*   Реализация системы генерации уникальных адресов для каждого депозита.
*   Добавление новых игровых режимов.
*   Разработка мобильного приложения.
*   Расширение функционала чата (личные сообщения, система жалоб на сообщения).
*   Более продвинутые инструменты модерации для чата.
*   Программа лояльности, бонусы, реферальная система.
*   Дополнительные функции ответственной игры (лимиты на депозиты, ставки, время игры).

## 8. Приложения

*   Приложение 1: Анализ сайта csgf.cc (файл `csgf_analysis.md`)
*   Приложение 2: Описание новых игровых режимов (файл `new_game_modes_description.md`)

(Эти файлы будут приложены к основному ТЗ при передаче Заказчику)

## 9. Порядок сдачи-приемки работ

Этапы разработки, тестирования и сдачи-приемки работ будут согласованы дополнительно между Заказчиком и Исполнителем.

